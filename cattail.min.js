export class CattailAudio{audioElement;audioContext=new AudioContext;player;clips=new Array;constructor(t){this.audioElement=t,this.player=this.audioContext.createMediaElementSource(this.audioElement),this.player.connect(this.audioContext.destination)}loadSound(t,e){let i=new AudioClip(t,e,this);return this.clips.push(i),i}async resumeAllSound(){this.clips.forEach((t=>{t.resume()}))}}class AudioClip{clipUrl;element;context;loadSuspension=!1;constructor(t,e,i){this.clipUrl=t,this.element=document.createElement("audio"),this.element.src=this.clipUrl,this.element.autoplay=!1,this.element.loop=e,document.body.append(this.element),this.context=i}play(){"suspended"!=this.context.audioContext.state?this.element.play():this.loadSuspension=!0}pause(){this.element.pause()}async resume(){await this.context.audioContext.resume(),this.loadSuspension&&(this.element.play(),this.loadSuspension=!1)}}export class Vector2{x;y;static zero=new Vector2(0,0);static up=new Vector2(0,1);static down=new Vector2(0,-1);static left=new Vector2(-1,0);static right=new Vector2(1,0);constructor(t,e){this.x=t,this.y=e}}export class Vector3{x;y;z;static zero=new Vector3(0,0,0);static up=new Vector3(0,1,0);static down=new Vector3(0,-1,0);static left=new Vector3(-1,0,0);static right=new Vector3(1,0,0);static forward=new Vector3(0,0,1);static back=new Vector3(0,0,-1);constructor(t,e,i){this.x=t,this.y=e,this.z=i}}export class Colour{colour;alpha;static red=new Colour(255,0,0);static green=new Colour(0,255,0);static blue=new Colour(0,0,255);static black=new Colour(0,0,0);static white=new Colour(255,255,255);constructor(t,e,i,s=1){this.colour=new Vector3(t,e,i),this.alpha=s}asCSSColour(){return`rgba(${this.colour.x},${this.colour.y},${this.colour.z},${this.alpha})`}}export class DrawList{static drawList=[]}export class Drawable{position;addToDrawList(){DrawList.drawList.push(this)}}export class Sprite extends Drawable{size;image;constructor(t,e,i){super(),this.position=t,this.size=e,i&&(this.image=new CattailImage(this.position,this.size,Colour.white,i))}move(){this.image&&(this.image.position=this.position)}}export class Shape extends Drawable{points;colour;fill=!1;constructor(t=Colour.red,...e){super(),this.points=e,this.colour=t}}export class Rectangle extends Shape{constructor(t,e,i=Colour.red){super(i,t,new Vector2(t.x+e.x,t.y),new Vector2(t.x+e.x,t.y+e.y),new Vector2(t.x,t.y+e.y))}}export class CattailImage{position;size;image;colour;constructor(t,e,i=Colour.white,s){this.position=t,this.size=e,this.colour=i;let o=new Image(e.x,e.y);o.src=s,this.image=o}}export class Text extends Drawable{maxWidth;font;text;fontSize;colour;constructor(t,e,i,s="sans-serif",o=Colour.black,n){super(),this.position=t,this.position.y=t.y+i/2,this.text=e,this.fontSize=i,this.font=s,this.colour=o,n&&(this.maxWidth=n)}}export class Graphics{context;constructor(t){this.context=t}draw(){}drawFromList(){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height),DrawList.drawList.forEach((t=>{let e=this.context;if(t instanceof Shape){let i=t;e.beginPath(),i.points.forEach((t=>{e.lineTo(t.x,t.y)})),e.stroke(),i.fill?(e.fillStyle=i.colour.asCSSColour(),e.fill()):e.closePath()}if(t instanceof Sprite){let i=t.image;e.drawImage(i.image,i.position.x,i.position.y,i.size.x,i.size.y)}if(t instanceof Text){let i=t,s=i.text,o=i.fontSize.toString()+"px "+i.font;if(e.font=o,e.fillStyle=i.colour.asCSSColour(),s.split("\n").length>1){let t=i.position.y;for(let o=0;o<s.split("\n").length;o++)i.maxWidth?e.fillText(s.split("\n")[o],i.position.x,t,i.maxWidth):e.fillText(s.split("\n")[o],i.position.x,t),t+=i.fontSize}else i.maxWidth?e.fillText(s,i.position.x,i.position.y,i.maxWidth):e.fillText(s,i.position.x,i.position.y)}removeItem(DrawList.drawList,t)}))}}function removeItem(t,e){const i=t.indexOf(e);return i>-1&&t.splice(i,1),t}export class Game{canvas;audioElement;context;graphicsContext;audio;entites;fps=1e3/60;currentLoop;static deltaTime=0;constructor(t,e){this.canvas=document.createElement("canvas"),this.canvas.width=t.x,this.canvas.height=t.y,this.canvas.style.backgroundColor=e.asCSSColour(),this.audioElement=document.createElement("audio"),this.audioElement.autoplay=!0,this.audioElement.innerText="Unable to start audio until webpage is clicked or interacted with.",this.context=this.canvas.getContext("2d"),document.body.append(this.canvas),document.body.append(this.audioElement),this.graphicsContext=new Graphics(this.context),this.audio=new CattailAudio(this.audioElement),this.entites=[]}addEntity(t){this.entites.push(t),t.active&&t.load()}run(){this.getUserGesture(),this.entites.forEach((t=>{t.active&&t.load()}));let t=0,e=i=>{Game.deltaTime=(i-t)/this.fps,t=i,this.entites.forEach((t=>{t.update()})),this.graphicsContext.drawFromList(),window.requestAnimationFrame(e)};window.requestAnimationFrame(e)}async getUserGesture(){try{const t=await waitForUserGesture();console.log("User clicked:",t),this.audio.resumeAllSound()}catch(t){console.error("Error while waiting for user gesture:",t)}}}export class Component{gameObject;load(...t){}update(...t){}}export class DrawData{draw;move(t){this.draw.position.x+=t.x,this.draw.position.y+=t.y,this.draw instanceof Sprite&&this.draw.move(),this.draw instanceof Shape&&this.draw.points.forEach((e=>{e.x+=t.x,e.y+=t.y}))}}export class Collider extends Component{static allColliders=[];position;size;collided;constructor(t,e){super(),this.position=t,this.size=e,Collider.allColliders.push(this)}collide(){let t=!1;return Collider.allColliders.forEach((e=>{e!=this&&getDistance(e.position.x,e.position.y,this.position.x,this.position.y)<e.size.x&&(t=!0)})),this.collided=t,t}}function getDistance(t,e,i,s){const o=i-t,n=s-e;return Math.hypot(o,n)}export class GameObject{sprite;components=[];collider;active=!0;scale=new Vector2(1,1);constructor(t,e){if(this.sprite=new DrawData,console.log(this.sprite),e&&(this.scale=e),t){if(this.sprite.draw=t,e&&this.sprite.draw instanceof Shape)return this.sprite.draw.points.forEach((t=>{t.x*=this.scale.x,t.y*=this.scale.y})),void(this.collider=new Collider(this.sprite.draw.position,new Vector2(this.sprite.draw.points[0].x+5,this.sprite.draw.points[this.sprite.draw.points.length-1].y+5)));this.sprite.draw instanceof Sprite&&(this.collider=new Collider(this.sprite.draw.position,new Vector2(this.sprite.draw.size.x+5,this.sprite.draw.size.y+5)))}}prepareDraw(){let t;this.collider&&(t=new Rectangle(this.collider.position,this.collider.size,Colour.green),t.addToDrawList()),this.sprite.draw.addToDrawList()}addComponent(t){this.components.push(t)}load(){this.components.forEach((t=>{t.gameObject=this})),this.components.forEach((t=>{t.load()}))}update(...t){this.prepareDraw(),null!=this.collider&&this.collider.collide(),this.components.forEach((t=>{t.update()}))}}function waitForUserGesture(){return new Promise((t=>{function e(i){document.removeEventListener("change",e),document.removeEventListener("click",e),document.removeEventListener("contextmenu",e),document.removeEventListener("dblclick",e),document.removeEventListener("mouseup",e),document.removeEventListener("pointerup",e),document.removeEventListener("reset",e),document.removeEventListener("submit",e),document.removeEventListener("touchend",e),t(i)}document.addEventListener("change",e),document.addEventListener("click",e),document.addEventListener("contextmenu",e),document.addEventListener("dblclick",e),document.addEventListener("mouseup",e),document.addEventListener("pointerup",e),document.addEventListener("reset",e),document.addEventListener("submit",e),document.addEventListener("touchend",e)}))}