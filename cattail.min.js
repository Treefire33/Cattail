export class CattailAudio{audioElement;audioContext=new AudioContext;player;clips=new Array;constructor(t){this.audioElement=t,this.player=this.audioContext.createMediaElementSource(this.audioElement),this.player.connect(this.audioContext.destination)}loadSound(t,e){let i=new AudioClip(t,e,this);return this.clips.push(i),i}async resumeAllSound(){this.clips.forEach((t=>{t.resume()}))}}class AudioClip{clipUrl;element;context;loadSuspension=!1;constructor(t,e,i){this.clipUrl=t,this.element=document.createElement("audio"),this.element.src=this.clipUrl,this.element.autoplay=!1,this.element.loop=e,document.body.append(this.element),this.context=i}play(){"suspended"!=this.context.audioContext.state?this.element.play():this.loadSuspension=!0}pause(){this.element.pause()}async resume(){await this.context.audioContext.resume(),this.loadSuspension&&(this.element.play(),this.loadSuspension=!1)}}export class Vector2{x;y;static zero=new Vector2(0,0);static up=new Vector2(0,1);static down=new Vector2(0,-1);static left=new Vector2(-1,0);static right=new Vector2(1,0);constructor(t,e){this.x=t,this.y=e}}export class Vector3{x;y;z;static zero=new Vector3(0,0,0);static up=new Vector3(0,1,0);static down=new Vector3(0,-1,0);static left=new Vector3(-1,0,0);static right=new Vector3(1,0,0);static forward=new Vector3(0,0,1);static back=new Vector3(0,0,-1);constructor(t,e,i){this.x=t,this.y=e,this.z=i}}export class Colour{colour;alpha;static red=new Colour(255,0,0);static green=new Colour(0,255,0);static blue=new Colour(0,0,255);static black=new Colour(0,0,0);static white=new Colour(255,255,255);constructor(t,e,i,s=1){this.colour=new Vector3(t,e,i),this.alpha=s}asCSSColour(){return`rgba(${this.colour.x},${this.colour.y},${this.colour.z},${this.alpha})`}}export class DrawList{static drawList=[]}export class Drawable{position=new Vector2(0,0);addToDrawList(){DrawList.drawList.push(this)}}export class Sprite extends Drawable{size;image;constructor(t,e,i){super(),this.position=t,this.size=e,i&&(this.image=new CattailImage(this.position,this.size,Colour.white,i))}move(){this.image&&(this.image.position=this.position)}}export class Shape extends Drawable{points;colour;fill=!1;constructor(t=Colour.red,...e){super(),this.points=e,this.colour=t}}export class Rectangle extends Shape{constructor(t,e,i=Colour.red){super(i,t,new Vector2(t.x+e.x,t.y),new Vector2(t.x+e.x,t.y+e.y),new Vector2(t.x,t.y+e.y))}}export class CattailImage{position;size;image;colour;constructor(t,e,i=Colour.white,s){this.position=t,this.size=e,this.colour=i;let o=new Image(e.x,e.y);o.src=s,this.image=o}}export class Text extends Drawable{maxWidth;font;text;fontSize;colour;constructor(t,e,i,s="sans-serif",o=Colour.black,n=1e4){super(),this.position=t,this.position.y=t.y+i/2,this.text=e,this.fontSize=i,this.font=s,this.colour=o,n&&(this.maxWidth=n)}}export class SpritesheetDrawable extends Drawable{image;cellSize;cellPosition;spriteSize;constructor(t,e,i,s){super(),this.cellSize=e,this.image=i.image,this.cellPosition=t,this.spriteSize=s?new Vector2(s.x/e.x,s.y/e.y):new Vector2(e.x,e.y)}}export class Spritesheet extends Drawable{image;imageDimensions;cellDimensions;cellPadding;spriteGroups;constructor(t,e,i,s){super(),this.image=new CattailImage(new Vector2(0,0),e,Colour.white,t),this.imageDimensions=e,this.cellDimensions=i,this.cellPadding=s,this.spriteGroups={}}createSpriteGroup(t,e){this.spriteGroups[t]=e}getSprite(t,e){return new SpritesheetDrawable(this.getFrameFromRowCol(t,e),this.cellDimensions,this.image)}getSpriteFromGroup(t,e,i){return this.spriteGroups[t]||console.error(`No group of name ${t}.`),new SpritesheetDrawable(this.getFrameFromRowCol(e+this.spriteGroups[t].x,i+this.spriteGroups[t].y),this.cellDimensions,this.image)}getFrameFromRowCol(t,e){return new Vector2(e*(this.cellPadding+this.cellDimensions.x),t*(this.cellPadding+this.cellDimensions.y))}}export class Graphics{context;constructor(t){this.context=t}draw(t){let e=this.context;if(t instanceof Shape){let i=t;e.beginPath(),i.points.forEach((t=>{e.lineTo(t.x,t.y)})),e.stroke(),i.fill?(e.fillStyle=i.colour.asCSSColour(),e.fill()):e.closePath()}if(t instanceof Sprite){let i=t.image;e.drawImage(i.image,i.position.x,i.position.y,i.size.x,i.size.y)}if(t instanceof Text){let i=t,s=i.text,o=i.fontSize.toString()+"px "+i.font;if(e.font=o,e.fillStyle=i.colour.asCSSColour(),s.split("\n").length>1){let t=i.position.y;for(let o=0;o<s.split("\n").length;o++)i.maxWidth?e.fillText(s.split("\n")[o],i.position.x,t,i.maxWidth):e.fillText(s.split("\n")[o],i.position.x,t),t+=i.fontSize}else i.maxWidth?e.fillText(s,i.position.x,i.position.y,i.maxWidth):e.fillText(s,i.position.x,i.position.y)}}drawFromList(){DrawList.drawList.forEach((t=>{let e=this.context;if(t instanceof Shape){let i=t;e.beginPath(),i.points.forEach((t=>{e.lineTo(t.x,t.y)})),e.stroke(),i.fill?(e.fillStyle=i.colour.asCSSColour(),e.fill()):e.closePath()}if(t instanceof Sprite){let i=t.image;e.drawImage(i.image,i.position.x,i.position.y,i.size.x,i.size.y)}if(t instanceof SpritesheetDrawable&&e.drawImage(t.image,t.cellPosition.x,t.cellPosition.y,t.cellSize.x,t.cellSize.y,t.position.x,t.position.y,t.spriteSize.x,t.spriteSize.y),t instanceof Text){let i=t,s=i.text,o=i.fontSize.toString()+"px "+i.font;if(e.font=o,e.fillStyle=i.colour.asCSSColour(),s.split("\n").length>1){let t=i.position.y;for(let o=0;o<s.split("\n").length;o++)i.maxWidth?e.fillText(s.split("\n")[o],i.position.x,t,i.maxWidth):e.fillText(s.split("\n")[o],i.position.x,t),t+=i.fontSize}else i.maxWidth?e.fillText(s,i.position.x,i.position.y,i.maxWidth):e.fillText(s,i.position.x,i.position.y)}removeItem(DrawList.drawList,t)}))}}function removeItem(t,e){const i=t.indexOf(e);return i>-1&&t.splice(i,1),t}export class Game{canvas;audioElement;context;graphicsContext;audio;entites;fps=1e3/60;currentLoop;backgroundImage;static deltaTime=0;static NullDrawable=new Drawable;constructor(t,e){this.canvas=document.createElement("canvas"),this.canvas.width=t.x,this.canvas.height=t.y,this.canvas.style.display="block",this.canvas.style.backgroundColor=e.asCSSColour(),this.audioElement=document.createElement("audio"),this.audioElement.autoplay=!0,this.audioElement.innerText="Unable to start audio until webpage is clicked or interacted with.",this.context=this.canvas.getContext("2d"),document.body.append(this.canvas),document.body.append(this.audioElement),this.graphicsContext=new Graphics(this.context),this.audio=new CattailAudio(this.audioElement),this.entites=[],window.addEventListener("resize",(()=>{this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,null==this.backgroundImage&&null==this.backgroundImage||(this.backgroundImage.image.size=new Vector2(this.canvas.width,this.canvas.height))})),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}setBackgroundImage(t){this.backgroundImage=new Sprite(new Vector2(0,0),new Vector2(this.canvas.width,this.canvas.height),t)}addEntity(t){this.entites.push(t),t.active&&t.load()}run(){this.getUserGesture(),this.entites.forEach((t=>{t.active&&t.load()}));let t=0,e=i=>{Game.deltaTime=(i-t)/this.fps,t=i,this.entites.forEach((t=>{t.update()})),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.graphicsContext.draw(this.backgroundImage),this.graphicsContext.drawFromList(),window.requestAnimationFrame(e)};window.requestAnimationFrame(e)}async getUserGesture(){try{const t=await waitForUserGesture();console.log("User clicked:",t),this.audio.resumeAllSound()}catch(t){console.error("Error while waiting for user gesture:",t)}}}export class Scene{entities}export class Component{gameObject;load(...t){}update(...t){}}export class DrawData{draw;move(t){this.draw.position.x+=t.x,this.draw.position.y+=t.y,this.draw instanceof Sprite&&this.draw.move(),this.draw instanceof Shape&&this.draw.points.forEach((e=>{e.x+=t.x,e.y+=t.y}))}}export class GameObject{sprite;components=[];active=!0;scale=new Vector2(1,1);constructor(t,e){this.sprite=new DrawData,e&&(this.scale=e),t?(this.sprite.draw=t,e&&this.sprite.draw instanceof Shape&&this.sprite.draw.points.forEach((t=>{t.x*=this.scale.x,t.y*=this.scale.y}))):this.sprite=null}setSprite(t,e){this.sprite=new DrawData,e&&(this.scale=e),t?(this.sprite.draw=t,e&&this.sprite.draw instanceof Shape&&this.sprite.draw.points.forEach((t=>{t.x*=this.scale.x,t.y*=this.scale.y}))):this.sprite=null}prepareDraw(){null!=this.sprite&&this.active&&this.sprite.draw.addToDrawList()}addComponent(t){this.components.push(t)}load(){this.components.forEach((t=>{t.gameObject=this})),this.components.forEach((t=>{t.load()}))}update(...t){this.prepareDraw(),this.components.forEach((t=>{t.update()}))}getComponent(t){let e;return this.components.forEach((i=>{console.log(i),console.log(i instanceof t),i instanceof t&&(e=i)})),e}}function waitForUserGesture(){return new Promise((t=>{function e(i){document.removeEventListener("change",e),document.removeEventListener("click",e),document.removeEventListener("contextmenu",e),document.removeEventListener("dblclick",e),document.removeEventListener("mouseup",e),document.removeEventListener("pointerup",e),document.removeEventListener("reset",e),document.removeEventListener("submit",e),document.removeEventListener("touchend",e),t(i)}document.addEventListener("change",e),document.addEventListener("click",e),document.addEventListener("contextmenu",e),document.addEventListener("dblclick",e),document.addEventListener("mouseup",e),document.addEventListener("pointerup",e),document.addEventListener("reset",e),document.addEventListener("submit",e),document.addEventListener("touchend",e)}))}export class TextComponent extends Component{textObj=null;text;size;font="sans-serif";constructor(t,e,i){super(),this.text=t,this.size=e,this.font=i}load(...t){this.textObj=new Text(this.gameObject.sprite.draw.position,this.text,this.size,this.font)}setFont(t){this.textObj.font=t}setSize(t){this.textObj.fontSize=t}setColour(t){this.textObj.colour=t}setText(t){this.textObj.text=t}anchor(){let t=new Vector2(this.textObj.position.x,this.textObj.position.y);this.textObj.position=t}anchorTo(t){this.textObj.position=t}update(...t){this.textObj.addToDrawList()}}